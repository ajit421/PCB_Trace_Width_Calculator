<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCB Trace Width Calculator</title>
    <style>
        /* User-provided CSS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #243c54 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 500px;
        }

        .inputs-section {
            padding: 40px;
            background: white;
            border-right: 1px solid #e0e0e0;
        }

        .results-section {
            padding: 40px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.95em;
        }

        .input-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .input-row input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: white;
        }

        .input-row input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .input-row select {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .input-row select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .results-title {
            font-size: 1.5em;
            margin-bottom: 30px;
            color: #2c3e50;
            font-weight: 600;
        }

        .result-card {
            background: rgba(124, 251, 162, 0.852);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-left: 4px solid #198604;
            border-right: 4px solid #198604;
            transition: transform 0.3s ease;
        }

        .result-card:hover {
            transform: translateY(-2px);
        }

        .result-card.internal {
            border-left-color: #379d1b;
        }

        .result-card.external {
            border-left-color: #379d1b;
        }

        .result-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 600;
            color: #34495e;
        }

        .result-value {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #2c3e50;
            background: #ecf0f1;
            padding: 4px 8px;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .width-display {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }

        .error {
            color: #e74c3c;
            font-size: 0.9em;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }

            .inputs-section {
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
            }

            .header h1 {
                font-size: 2em;
            }

            .container {
                margin: 10px;
                padding: 0;
            }

            body {
                padding: 0;
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.02);
            }

            100% {
                transform: scale(1);
            }
        }

        /* Original styles for functionality */
        .mode-toggle {
            display: flex;
            justify-content: center;
            margin: 25px 0 0;
            gap: 10px;
            padding-bottom: 25px;
            background: white;
        }

        .mode-btn {
            background: #b5d2bc;
            color: #3b4c5e;
            border: 2px solid transparent;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 600;
        }

        .mode-btn:hover {
            background: #f60676;
        }

        .mode-btn.active {
            background: #ff9f0a;
            color: white;
            border-color: #81b387;
        }

        .hidden {
            display: none;
        }

        .width-inputs {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .width-input-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .width-input-row label {
            min-width: 70px;
            font-weight: normal;
            color: #34495e;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>PCB Trace Width Calculator</h1>
            <p>Real-Time calculator for PCB trace width and temperature rise.</p>
        </div>

        <!-- MODE TOGGLE BUTTONS -->
        <div class="mode-toggle">
            <button class="mode-btn active" data-mode="width">
                Calculate Width
            </button>
            <button class="mode-btn" data-mode="rise">
                Calculate Temp Rise
            </button>
        </div>

        <div class="content">
            <div class="inputs-section">
                <!-- Common Inputs -->
                <div class="input-group">
                    <label for="trace_current">Current (A)</label>
                    <div class="input-row">
                        <input type="number" id="trace_current" step="0.1" value="15" min="0" />
                    </div>
                </div>

                <div class="input-group">
                    <label for="trace_ambient">Ambient Temperature</label>
                    <div class="input-row">
                        <input type="number" id="trace_ambient" step="0.1" value="30" />
                        <select id="trace_ambientUnit">
                            <option value="°C">°C</option>
                            <option value="°F">°F</option>
                        </select>
                    </div>
                </div>

                <!-- Temperature Rise Input (for width calculation mode) -->
                <div class="input-group rise-input">
                    <label for="trace_rise">Temperature Rise</label>
                    <div class="input-row">
                        <input type="number" id="trace_rise" step="0.1" value="30" min="0" />
                        <select id="trace_riseUnit">
                            <option value="°C">°C</option>
                            <option value="°F">°F</option>
                        </select>
                    </div>
                </div>

                <div class="input-group">
                    <label for="trace_length_input">Trace Length</label>
                    <div class="input-row">
                        <input type="number" id="trace_length_input" step="0.1" value="10" />
                        <select id="trace_traceUnit">
                            <option value="in">in</option>
                            <option value="ft">ft</option>
                            <option value="mil">mil</option>
                            <option value="mm">mm</option>
                            <option value="µm">µm</option>
                            <option value="cm">cm</option>
                            <option value="m">m</option>
                        </select>
                    </div>
                </div>

                <!-- Thickness Input (common for both modes) -->
                <div class="input-group thickness-input">
                    <label for="trace_thickness">Copper Thickness</label>
                    <div class="input-row">
                        <input type="number" id="trace_thickness" step="0.1" value="40" />
                        <select id="trace_thicknessUnit">
                            <option value="oz/ft²">oz/ft²</option>
                            <option value="mil">mil</option>
                            <option value="mm">mm</option>
                            <option value="µm">µm</option>
                        </select>
                    </div>
                </div>

                <!-- Width Input (for temp rise calculation mode) -->
                <div class="input-group width-input hidden">
                    <label>Trace Width</label>
                    <div class="width-inputs">
                        <div class="width-input-row">
                            <label for="trace_width_internal">Internal:</label>
                            <input type="number" id="trace_width_internal" step="0.1" value="0.5" min="0" />
                            <select id="trace_widthUnit_internal">
                                <option value="mil">mil</option>
                                <option value="mm" selected> mm</option>
                                <option value="µm">µm</option>
                            </select>
                        </div>
                        <div class="width-input-row">
                            <label for="trace_width_external">External:</label>
                            <input type="number" id="trace_width_external" step="0.1" value="0.5" min="0" />
                            <select id="trace_widthUnit_external">
                                <option value="mil">mil</option>
                                <option value="mm" selected> mm</option>
                                <option value="µm">µm</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div class="results-section">
                <h2 class="results-title">Calculation Results</h2>

                <!-- Width Results (shown by default) -->
                <div class="width-results">
                    <div class="result-card internal">
                        <h3>Internal Layers</h3>
                        <div class="width-display" id="internalWidth">
                            Width: Loading...
                        </div>
                        <div class="result-item">
                            <span class="result-label">Resistance:</span>
                            <span class="result-value" id="internalResistance">- Ω</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Voltage Drop:</span>
                            <span class="result-value" id="internalVoltage">- V</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Power Loss:</span>
                            <span class="result-value" id="internalPower">- W</span>
                        </div>
                    </div>

                    <div class="result-card external">
                        <h3>External Layers in Air</h3>
                        <div class="width-display" id="externalWidth">
                            Width: Loading...
                        </div>
                        <div class="result-item">
                            <span class="result-label">Resistance:</span>
                            <span class="result-value" id="externalResistance">- Ω</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Voltage Drop:</span>
                            <span class="result-value" id="externalVoltage">- V</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Power Loss:</span>
                            <span class="result-value" id="externalPower">- W</span>
                        </div>
                    </div>
                </div>

                <!-- Temperature Rise Results (hidden by default) -->
                <div class="rise-results hidden">
                    <div class="result-card internal">
                        <h3>Internal Layers</h3>
                        <div class="width-display" id="internalRise">
                            Temperature Rise: Loading...
                        </div>
                        <div class="result-item">
                            <span class="result-label">Resistance:</span>
                            <span class="result-value" id="internalRiseResistance">- Ω</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Voltage Drop:</span>
                            <span class="result-value" id="internalRiseVoltage">- V</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Power Loss:</span>
                            <span class="result-value" id="internalRisePower">- W</span>
                        </div>
                    </div>

                    <div class="result-card external">
                        <h3>External Layers in Air</h3>
                        <div class="width-display" id="externalRise">
                            Temperature Rise: Loading...
                        </div>
                        <div class="result-item">
                            <span class="result-label">Resistance:</span>
                            <span class="result-value" id="externalRiseResistance">- Ω</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Voltage Drop:</span>
                            <span class="result-value" id="externalRiseVoltage">- V</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Power Loss:</span>
                            <span class="result-value" id="externalRisePower">- W</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ======================================
        // TRACE CALCULATOR SCRIPT
        // ======================================
        (function () {
            const traceTab = document.querySelector(".container");

            // Mode toggle functionality
            const modeButtons = traceTab.querySelectorAll(".mode-btn");
            modeButtons.forEach((btn) => {
                btn.addEventListener("click", () => {
                    const mode = btn.getAttribute("data-mode");

                    modeButtons.forEach((b) => b.classList.remove("active"));
                    btn.classList.add("active");

                    const riseInput = traceTab.querySelector(".rise-input");
                    const widthInput = traceTab.querySelector(".width-input");
                    const widthResults = traceTab.querySelector(".width-results");
                    const riseResults = traceTab.querySelector(".rise-results");

                    if (mode === "width") {
                        riseInput.classList.remove("hidden");
                        widthInput.classList.add("hidden");
                        widthResults.classList.remove("hidden");
                        riseResults.classList.add("hidden");
                    } else if (mode === "rise") {
                        riseInput.classList.add("hidden");
                        widthInput.classList.remove("hidden");
                        widthResults.classList.add("hidden");
                        riseResults.classList.remove("hidden");
                    }
                    updateResults();
                });
            });

            // Add event listeners to all inputs
            const inputs = traceTab.querySelectorAll("input, select");
            inputs.forEach((input) => {
                input.addEventListener("input", updateResults);
                input.addEventListener("change", updateResults);
            });

            // --- Conversion functions ---
            const milToMm = (mil) => mil * 0.0254;
            const milToUm = (mil) => mil * 25.4;
            const ozToMil = (oz) => oz * 1.37;
            const mmToMil = (mm) => mm / 0.0254;
            const umToMil = (um) => um / 25.4;
            const cToF = (c) => (c * 9 / 5) + 32;
            const fToC = (f) => (f - 32) * 5 / 9;

            // --- Core calculation functions from IPC-2221 standard ---
            const externalArea = (current, rise) => Math.pow(current / (0.048 * Math.pow(rise, 0.44)), 1 / 0.725);
            const internalArea = (current, rise) => Math.pow(current / (0.024 * Math.pow(rise, 0.44)), 1 / 0.725);

            const externalRise = (current, area) => Math.pow(current / (0.048 * Math.pow(area, 0.725)), 1 / 0.44);
            const internalRise = (current, area) => Math.pow(current / (0.024 * Math.pow(area, 0.725)), 1 / 0.44);

            function getInputs() {
                const getValue = (id) => parseFloat(document.getElementById(id).value) || 0;
                const getUnit = (id) => document.getElementById(id).value;

                return {
                    current: getValue('trace_current'),
                    ambient: getValue('trace_ambient'),
                    ambientUnit: getUnit('trace_ambientUnit'),
                    rise: getValue('trace_rise'),
                    riseUnit: getUnit('trace_riseUnit'),
                    length: getValue('trace_length_input'),
                    lengthUnit: getUnit('trace_traceUnit'),
                    thickness: getValue('trace_thickness'),
                    thicknessUnit: getUnit('trace_thicknessUnit'),
                    widthInternal: getValue('trace_width_internal'),
                    widthUnitInternal: getUnit('trace_widthUnit_internal'),
                    widthExternal: getValue('trace_width_external'),
                    widthUnitExternal: getUnit('trace_widthUnit_external'),
                    isWidthMode: document.querySelector(".mode-btn.active").getAttribute("data-mode") === "width"
                };
            }

            function convertUnits(inputs) {
                let { thickness, length, rise, ambient, widthInternal, widthExternal } = inputs;

                // Convert thickness to mil
                if (inputs.thicknessUnit === "oz/ft²") thickness = ozToMil(thickness);
                else if (inputs.thicknessUnit === "mm") thickness = mmToMil(thickness);
                else if (inputs.thicknessUnit === "µm") thickness = umToMil(thickness);

                // Convert length to cm
                if (inputs.lengthUnit === "in") length *= 2.54;
                else if (inputs.lengthUnit === "ft") length *= 30.48;
                else if (inputs.lengthUnit === "mil") length *= 0.00254;
                else if (inputs.lengthUnit === "mm") length *= 0.1;
                else if (inputs.lengthUnit === "µm") length *= 0.0001;
                else if (inputs.lengthUnit === "m") length *= 100;

                // Convert temperatures to Celsius
                if (inputs.riseUnit === "°F") rise = fToC(rise);
                if (inputs.ambientUnit === "°F") ambient = fToC(ambient);

                // Convert widths to mil
                if (inputs.widthUnitInternal === "mm") widthInternal = mmToMil(widthInternal);
                else if (inputs.widthUnitInternal === "µm") widthInternal = umToMil(widthInternal);

                if (inputs.widthUnitExternal === "mm") widthExternal = mmToMil(widthExternal);
                else if (inputs.widthUnitExternal === "µm") widthExternal = umToMil(widthExternal);

                return { ...inputs, thickness, length, rise, ambient, widthInternal, widthExternal };
            }

            function calculateWidth(data) {
                const { current, rise, thickness, length, ambient } = data;
                if (current <= 0 || rise <= 0 || thickness <= 0) return null;

                const areaI = internalArea(current, rise);
                const widthI = areaI / thickness;

                const areaE = externalArea(current, rise);
                const widthE = areaE / thickness;

                const resI = calculateResistance(areaI, length, ambient + rise);
                const resE = calculateResistance(areaE, length, ambient + rise);

                return {
                    internal: { width: widthI, ...resI },
                    external: { width: widthE, ...resE },
                };
            }

            function calculateRise(data) {
                const { current, thickness, widthInternal, widthExternal, length, ambient } = data;
                if (current <= 0 || thickness <= 0 || widthInternal <= 0 || widthExternal <= 0) return null;

                const areaI = widthInternal * thickness;
                const riseI = internalRise(current, areaI);

                const areaE = widthExternal * thickness;
                const riseE = externalRise(current, areaE);

                const resI = calculateResistance(areaI, length, ambient + riseI);
                const resE = calculateResistance(areaE, length, ambient + riseE);

                return {
                    internal: { rise: riseI, ...resI },
                    external: { rise: riseE, ...resE },
                };
            }

            function calculateResistance(areaMil2, lengthCm, tempC) {
                const rho = 1.724e-6; // Resistivity of copper in Ω·cm at 20°C
                const alpha = 0.00393; // Temp coefficient for copper
                const areaCm2 = areaMil2 * 6.4516e-6;

                const resistance = (rho * lengthCm / areaCm2) * (1 + alpha * (tempC - 20));
                const voltageDrop = data.current * resistance;
                const powerLoss = data.current * voltageDrop;

                return { resistance, voltageDrop, powerLoss };
            }

            function displayResults(result) {
                const format = (val, prec = 11) => (val && isFinite(val)) ? val.toFixed(prec) : "Error";

                if (data.isWidthMode) {
                    document.getElementById('internalWidth').innerHTML = `Width: ${format(result.internal.width)} mil<br>${format(milToMm(result.internal.width))} mm | ${format(milToUm(result.internal.width))} µm`;
                    document.getElementById('externalWidth').innerHTML = `Width: ${format(result.external.width)} mil<br>${format(milToMm(result.external.width))} mm | ${format(milToUm(result.external.width))} µm`;

                    document.getElementById('internalResistance').textContent = `${format(result.internal.resistance)} Ω`;
                    document.getElementById('internalVoltage').textContent = `${format(result.internal.voltageDrop)} V`;
                    document.getElementById('internalPower').textContent = `${format(result.internal.powerLoss)} W`;

                    document.getElementById('externalResistance').textContent = `${format(result.external.resistance)} Ω`;
                    document.getElementById('externalVoltage').textContent = `${format(result.external.voltageDrop)} V`;
                    document.getElementById('externalPower').textContent = `${format(result.external.powerLoss)} W`;
                } else {
                    document.getElementById('internalRise').innerHTML = `Rise: ${format(result.internal.rise)} °C<br>${format(cToF(result.internal.rise))} °F`;
                    document.getElementById('externalRise').innerHTML = `Rise: ${format(result.external.rise)} °C<br>${format(cToF(result.external.rise))} °F`;

                    document.getElementById('internalRiseResistance').textContent = `${format(result.internal.resistance)} Ω`;
                    document.getElementById('internalRiseVoltage').textContent = `${format(result.internal.voltageDrop)} V`;
                    document.getElementById('internalRisePower').textContent = `${format(result.internal.powerLoss)} W`;

                    document.getElementById('externalRiseResistance').textContent = `${format(result.external.resistance)} Ω`;
                    document.getElementById('externalRiseVoltage').textContent = `${format(result.external.voltageDrop)} V`;
                    document.getElementById('externalRisePower').textContent = `${format(result.external.powerLoss)} W`;
                }
            }

            let data = {};
            function updateResults() {
                const rawInputs = getInputs();
                data = convertUnits(rawInputs);

                const result = data.isWidthMode ? calculateWidth(data) : calculateRise(data);

                if (result) {
                    displayResults(result);
                }
            }

            // Initial calculation
            updateResults();
        })();
    </script>
</body>

</html>